<link rel="stylesheet" href="{{ 'instagram-reels.css' | asset_url }}">

<div 
  class="instagram-reels-section" 
  data-block-id="{{ block.id }}"
  data-instagram-reels-block
>
  <div 
    class="instagram-reels-container"
    id="instagram-reels-{{ block.id }}"
    data-shop="{{ shop.permanent_domain }}"
  >
    <div class="instagram-reels-loading">
      <p>Loading Instagram Feed...</p>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';
  
  const blockId = '{{ block.id }}';
  const container = document.getElementById('instagram-reels-' + blockId);
  
  if (!container) {
    console.error('Instagram Reels Block: Container not found for block', blockId);
    return;
  }
  
  let registrationAttempts = 0;
  const maxAttempts = 50;
  
  function registerWithEmbed() {
    registrationAttempts++;
    
    if (window.InstagramReelsApp) {
      if (window.InstagramReelsApp.isInitialized) {
        console.log('Instagram Reels Block: Registering with initialized embed');
        window.InstagramReelsApp.registerBlock(blockId, container, {});
      } else {
        console.log('Instagram Reels Block: Waiting for embed to initialize...');
        setTimeout(registerWithEmbed, 100);
      }
    } else {
      if (registrationAttempts < maxAttempts) {
        setTimeout(registerWithEmbed, 100);
      } else {
        container.innerHTML = `
          <div class="instagram-reels-error" style="text-align: center; padding: 40px 20px;">
            <p style="color: #d32f2f; margin-bottom: 10px;">Instagram Reels App Embed is not enabled</p>
            <p style="color: #666; font-size: 14px;">Please enable it in Theme Editor → App Embeds → Instagram Reels App</p>
          </div>
        `;
      }
    }
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', registerWithEmbed);
  } else {
    registerWithEmbed();
  }
})();
</script>

{% schema %}
{
  "name": "Instagram Reels",
  "target": "section",
}
{% endschema %}